<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="main.css">
  </head>
  <script type="module" src="main.js"></script>
  <body>
    <script type="module">
      import { getCookie } from "./main.js"
      const session = getCookie("session")
      const user = sessionStorage.getItem("user")
      const name = document.getElementById("name")
      const apellidos = document.getElementById("apellidos")
      const email = document.getElementById("email")
      const phone = document.getElementById("phone")
      const phonePrefix = document.getElementById("phonePrefix")
      if (user) {
        const parsed = JSON.parse(user)
        if (parsed) {
          name.value = parsed.name
          apellidos.value = parsed.apellidos
          email.value = parsed.email
          phone.value = parsed.phone
          phonePrefix.value = parsed.phone_prefix
        }
      } else if (session) {

      }
      
    </script>
    <fourb-header></fourb-header>
    <div>Account</div>
    <form action="http://localhost:8000/user" method="PATCH" id="account">
      <label for="name">Nombre</label>
      <input id="name" type="text" name="name" required />
      <label for="apellidos">Apellidos</label>
      <input id="apellidos" type="text" name="apellidos" required />
      <label for="email">Email</label>
      <input id="email" type="text" name="email" required />
      <label for="text">Phone</label>
      <div style="display: flex; flex-direction: row;">
        <select id="phonePrefix" type="text" name="phonePrefix" required>
          <option value="+52">ðŸ‡²ðŸ‡½ Mexico (+52)</option>
        </selecy>
        <input id="phone" type="text" name="phone" required />
      </div>
      <button type="submit">Actualizar</button>
    </form>
    <script type="module">
      import { fetchWrapper } from "./main.js"
      const form = document.getElementById("account")
      const editAccount = async (e) => {
        e.preventDefault()
        try {
          const data = await fetchWrapper("http://localhost:8000/user", {
            method: 'PATCH',
            body: JSON.stringify({
              name: form.name.value,
              apellidos: form.apellidos.value,
              phone: form.phone.value,
              email: form.email.value,
              phonePrefix: form.phonePrefix.value,
            }),
          })
        } catch(e) {
          if (e instanceof Error) {
            alert(e.message)
          } else {
            alert("Error")
          }
        }
      }
      form.addEventListener("submit", editAccount)
    </script>
  </body>
</html>