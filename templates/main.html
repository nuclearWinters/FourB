<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="main.css">
</head>
<script type="module" src="main.js"></script>

<body>
  <script type="module">
    import { fetchWrapper, insertHTML } from "./main.js"
    fetchWrapper('https://{{domain}}/inventory')
      .then(json => {
        const loading = document.getElementById("loading")
        if (loading) {
          loading.style.display = "none"
        }
        const list = document.querySelector('#products')
        json.forEach(product => {
          insertHTML(
            list,
            `<div class="product-card">
              <div class="name">${product.name}</div>
              <div class="price">
                <span>Precio: </span>
                <span class="${product.use_discount ? "price-discounted" : ""}">$${(product.price / 100).toFixed(2)}</span>
                ${product.use_discount ? `<span>$${(product.discount_price / 100).toFixed(2)}</span>` : ""}
              </div>
              <img class="img-product" src="${product.img}" />
              <button class="fourb-button" onclick="(() => {
                window.location.href = '/product-${product._id}'
              })()">VER</button>
              <button id="add-to-cart-${product._id}" class="fourb-button">
                AÑADIR AL CARRITO
              </button>
            </div>`
          )
          const buyButton = document.getElementById(`add-to-cart-${product._id}`)
          buyButton.onclick = async () => {
            try {
              const data = await fetchWrapper('https://{{domain}}/add-to-cart', {
                method: "POST",
                body: JSON.stringify({
                  product_id: product._id,
                  qty: 1
                })
              })
              alert("Añadido al carrito")
            } catch (e) {
              if (e instanceof Error) {
                alert(e.message)
              } else {
                alert("Error")
              }
            }
          }
        })
      });
  </script>
  <fourb-header></fourb-header>
  <h2 class="title">Productos</h2>
  <div class="loading" id="loading"></div>
  <div id="products" style="display: flex; flex-wrap: wrap; justify-content: center;"></div>
</body>

</html>